# MedRoundTable - ç³»ç»Ÿæ¶æ„è®¾è®¡

## 1. æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚ (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç™»å½•/æ³¨å†Œ   â”‚  â”‚  åœ†æ¡Œä¼šç•Œé¢  â”‚  â”‚      ç ”ç©¶ç®¡ç†é¢æ¿        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway (Backend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç”¨æˆ·è®¤è¯    â”‚  â”‚  åœ†æ¡Œä¼šç®¡ç†  â”‚  â”‚     æ–‡æ¡£/æŠ¥å‘Šç”Ÿæˆ        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      A2A åè°ƒå±‚ (Orchestrator)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              åœ†æ¡Œä¼šä¼šè¯ç®¡ç†å™¨ (Session Manager)            â”‚    â”‚
â”‚  â”‚  - åˆ›å»º/ç®¡ç†åœ†æ¡Œä¼š                                        â”‚    â”‚
â”‚  â”‚  - Agentè°ƒåº¦ä¸åè°ƒ                                        â”‚    â”‚
â”‚  â”‚  - æ¶ˆæ¯è·¯ç”±ä¸çŠ¶æ€ç®¡ç†                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ‘¨â€âš•ï¸ ä¸´åºŠä¸»ä»»    â”‚ â”‚   ğŸ“š åšå£«ç”Ÿ      â”‚ â”‚   ğŸ“Š æµè¡Œç—…å­¦å®¶  â”‚
â”‚     Agent       â”‚ â”‚     Agent       â”‚ â”‚     Agent       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“ˆ ç»Ÿè®¡ä¸“å®¶    â”‚ â”‚   ğŸ‘©â€âš•ï¸ ç ”ç©¶æŠ¤å£«    â”‚
â”‚     Agent       â”‚ â”‚     Agent       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. A2A é€šä¿¡åè®®

### 2.1 æ¶ˆæ¯æ ¼å¼

```typescript
interface A2AMessage {
  id: string;                    // æ¶ˆæ¯å”¯ä¸€ID
  sessionId: string;             // åœ†æ¡Œä¼šä¼šè¯ID
  from: AgentRole;               // å‘é€è€…è§’è‰²
  to: AgentRole | 'all';         // æ¥æ”¶è€…ï¼ˆå•æ’­/å¹¿æ’­ï¼‰
  type: MessageType;             // æ¶ˆæ¯ç±»å‹
  content: string;               // æ¶ˆæ¯å†…å®¹
  metadata: {
    timestamp: number;
    round: number;               // è®¨è®ºè½®æ¬¡
    context: any;                // ä¸Šä¸‹æ–‡ä¿¡æ¯
  };
}

type AgentRole = 
  | 'clinical_director'      // ä¸´åºŠä¸»ä»»
  | 'phd_student'           // åšå£«ç”Ÿ
  | 'epidemiologist'        // æµè¡Œç—…å­¦å®¶
  | 'statistician'          // ç»Ÿè®¡ä¸“å®¶
  | 'research_nurse';       // ç ”ç©¶æŠ¤å£«

type MessageType = 
  | 'proposal'              // æè®®
  | 'question'              // æé—®
  | 'feedback'              // åé¦ˆ
  | 'agreement'             // åŒæ„
  | 'objection'             // å¼‚è®®
  | 'summary';              // æ€»ç»“
```

### 2.2 è®¨è®ºæµç¨‹çŠ¶æ€æœº

```
[INIT] åˆå§‹åŒ–
  â†“
[PROBLEM_PRESENTATION] é—®é¢˜é™ˆè¿°ï¼ˆä¸´åºŠä¸»ä»»æå‡ºï¼‰
  â†“
[DISCUSSION_ROUND_1] ç¬¬ä¸€è½®è®¨è®ºï¼ˆå…¨ä½“Agentï¼‰
  â†“
[SCENARIO_DESIGN] ç ”ç©¶æ–¹æ¡ˆè®¾è®¡ï¼ˆæµè¡Œç—…å­¦å®¶ä¸»å¯¼ï¼‰
  â†“
[CRF_DESIGN] æ•°æ®è¡¨æ ¼è®¾è®¡ï¼ˆç»Ÿè®¡ä¸“å®¶ä¸»å¯¼ï¼‰
  â†“
[EXECUTION_PLAN] æ‰§è¡Œè®¡åˆ’ï¼ˆç ”ç©¶æŠ¤å£«ä¸»å¯¼ï¼‰
  â†“
[CONSENSUS_REACHED] è¾¾æˆå…±è¯†
  â†“
[OUTPUT_GENERATION] è¾“å‡ºæˆæœ
  â†“
[COMPLETED] å®Œæˆ
```

## 3. Agent ç³»ç»Ÿè®¾è®¡

### 3.1 åŸºç¡€ Agent ç±»

```python
class BaseAgent:
    def __init__(self, role: AgentRole, llm_client):
        self.role = role
        self.llm = llm_client
        self.memory = ConversationMemory()
        self.expertise = self._load_expertise()
    
    async def receive_message(self, message: A2AMessage):
        """æ¥æ”¶æ¶ˆæ¯å¹¶å†³ç­–æ˜¯å¦å“åº”"""
        pass
    
    async def generate_response(self, context: DiscussionContext) -> A2AMessage:
        """ç”Ÿæˆå“åº”"""
        pass
    
    async def evaluate_proposal(self, proposal: str) -> Evaluation:
        """è¯„ä¼°æè®®"""
        pass
```

### 3.2 å„ Agent ä¸“é•¿å®šä¹‰

#### ä¸´åºŠä¸»ä»» Agent
```yaml
role: clinical_director
expertise:
  - ç–¾ç—…æœºåˆ¶ç†è§£
  - ä¸´åºŠé—®é¢˜è¯†åˆ«
  - ç ”ç©¶ä»·å€¼è¯„ä¼°
  - ä¸´åºŠå¯è¡Œæ€§åˆ¤æ–­
responsibilities:
  - æå‡ºç ”ç©¶é—®é¢˜
  - è¯„ä¼°ç ”ç©¶ä»·å€¼
  - åˆ¤æ–­ä¸´åºŠå¯è¡Œæ€§
  - æœ€ç»ˆå†³ç­–æƒ
```

#### åšå£«ç”Ÿ Agent
```yaml
role: phd_student
expertise:
  - æ–‡çŒ®æ£€ç´¢
  - ç»¼è¿°æ’°å†™
  - ç ”ç©¶åè°ƒ
  - è¿›åº¦ç®¡ç†
responsibilities:
  - æ–‡çŒ®è°ƒç ”
  - æ•´ç†è®¨è®ºè®°å½•
  - åè°ƒå„ç¯èŠ‚
  - ç”ŸæˆæŠ¥å‘Š
```

#### æµè¡Œç—…å­¦å®¶ Agent
```yaml
role: epidemiologist
expertise:
  - ç ”ç©¶è®¾è®¡
  - çº³å…¥æ’é™¤æ ‡å‡†
  - è´¨é‡æ§åˆ¶
  - åå€šæ§åˆ¶
responsibilities:
  - è®¾è®¡ç ”ç©¶æ–¹æ¡ˆ
  - åˆ¶å®šæ ‡å‡†
  - è¯„ä¼°å¯è¡Œæ€§
```

#### ç»Ÿè®¡ä¸“å®¶ Agent
```yaml
role: statistician
expertise:
  - ç»Ÿè®¡æ–¹æ³•é€‰æ‹©
  - æ ·æœ¬é‡è®¡ç®—
  - CRFè®¾è®¡
  - æ•°æ®å¯è§†åŒ–
responsibilities:
  - è®¾è®¡åˆ†æè®¡åˆ’
  - è®¾è®¡æ•°æ®è¡¨æ ¼
  - ç”Ÿæˆç»Ÿè®¡å›¾è¡¨
```

#### ç ”ç©¶æŠ¤å£« Agent
```yaml
role: research_nurse
expertise:
  - æ•°æ®é‡‡é›†æµç¨‹
  - è´¨é‡æ§åˆ¶
  - æ“ä½œè§„èŒƒ
  - é—®é¢˜åé¦ˆ
responsibilities:
  - è®¾è®¡é‡‡é›†æµç¨‹
  - åˆ¶å®šæ“ä½œæ‰‹å†Œ
  - è¯„ä¼°æ‰§è¡Œéš¾åº¦
```

## 4. æ•°æ®æ¨¡å‹

### 4.1 åœ†æ¡Œä¼š (RoundTable)
```typescript
interface RoundTable {
  id: string;
  title: string;
  clinicalQuestion: string;
  status: RoundTableStatus;
  participants: AgentRole[];
  messages: A2AMessage[];
  createdAt: Date;
  completedAt?: Date;
  output?: ResearchOutput;
}
```

### 4.2 ç ”ç©¶æˆæœ (ResearchOutput)
```typescript
interface ResearchOutput {
  studyDesign: StudyDesign;
  crfTemplate: CRFTemplate;
  analysisPlan: AnalysisPlan;
  operationManual: string;
  generatedAt: Date;
}
```

## 5. API è®¾è®¡

### 5.1 åœ†æ¡Œä¼šç®¡ç†
```
POST   /api/v1/roundtables              # åˆ›å»ºåœ†æ¡Œä¼š
GET    /api/v1/roundtables              # åˆ—è¡¨
GET    /api/v1/roundtables/:id          # è¯¦æƒ…
POST   /api/v1/roundtables/:id/start    # å¼€å§‹è®¨è®º
POST   /api/v1/roundtables/:id/pause    # æš‚åœ
POST   /api/v1/roundtables/:id/resume   # æ¢å¤
```

### 5.2 æ¶ˆæ¯ä¸äº¤äº’
```
GET    /api/v1/roundtables/:id/messages              # è·å–æ¶ˆæ¯
POST   /api/v1/roundtables/:id/messages              # ç”¨æˆ·å‘é€æ¶ˆæ¯
GET    /api/v1/roundtables/:id/stream                # SSEæ¶ˆæ¯æµ
POST   /api/v1/roundtables/:id/agents/:role/respond  # æ‰‹åŠ¨è§¦å‘Agentå“åº”
```

### 5.3 æˆæœè¾“å‡º
```
GET    /api/v1/roundtables/:id/output               # è·å–æˆæœ
POST   /api/v1/roundtables/:id/output/export        # å¯¼å‡ºæ–‡æ¡£
GET    /api/v1/roundtables/:id/output/docx          # ä¸‹è½½Word
GET    /api/v1/roundtables/:id/output/pdf           # ä¸‹è½½PDF
```

## 6. éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Load Balancer                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚  â”‚   Backend   â”‚  â”‚  WebSocket  â”‚
â”‚   Pod x2    â”‚  â”‚    Pod x3   â”‚  â”‚   Pod x2    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚  â”‚    Redis    â”‚  â”‚   OpenAI    â”‚
â”‚  (Primary)  â”‚  â”‚  (Cache/    â”‚  â”‚     API     â”‚
â”‚             â”‚  â”‚   Queue)    â”‚  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. å®‰å…¨ä¸éšç§

1. **æ•°æ®åŠ å¯†**: ä¼ è¾“TLS 1.3ï¼Œå­˜å‚¨AES-256
2. **è®¿é—®æ§åˆ¶**: JWT + RBAC
3. **å®¡è®¡æ—¥å¿—**: å®Œæ•´æ“ä½œè®°å½•
4. **æ•°æ®éš”ç¦»**: å¤šç§Ÿæˆ·æ¶æ„
5. **åˆè§„**: HIPAA/GDPR ready

## 8. æ‰©å±•æ€§è®¾è®¡

1. **æ–°Agentæ·»åŠ **: æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒè‡ªå®šä¹‰Agent
2. **å¤šè¯­è¨€æ”¯æŒ**: i18næ¡†æ¶ï¼Œæ”¯æŒä¸­è‹±æ–‡
3. **ç¬¬ä¸‰æ–¹é›†æˆ**: FHIR/HL7æ ‡å‡†ï¼ŒEMRç³»ç»Ÿå¯¹æ¥
4. **æ¨¡å‹åˆ‡æ¢**: æ”¯æŒå¤šç§LLMåç«¯
